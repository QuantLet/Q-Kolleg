BERLIN

SFB 6 4 9 E C O N O M I C R I S K

SFB 649 Discussion Paper 2011-002
A Confidence Corridor for Sparse Longitudinal
Data Curves
Shuzhuan Zheng* Lijian Yang*
Wolfgang Karl Härdle**
*Michigan State University, USA ** Humboldt-Universität zu Berlin, Germany
This research was supported by the Deutsche Forschungsgemeinschaft through the SFB 649 "Economic Risk".
http://sfb649.wiwi.hu-berlin.de ISSN 1860-5664
SFB 649, Humboldt-Universität zu Berlin Spandauer Straße 1, D-10178 Berlin

Submitted to the Annals of Statistics
A CONFIDENCE CORRIDOR FOR SPARSE LONGITUDINAL DATA CURVES
By Shuzhuan Zheng1 , Lijian Yang2,1 and Wolfgang K. Ha¨rdle3,4
1Michigan State University, 2Soochow University, 3Humboldt-Universita¨t zu Berlin and 4National Central University
Longitudinal data analysis is a central piece of statistics. The data are curves and they are observed at random locations. This makes the construction of a simultaneous confidence corridor (SCC) (confidence band) for the mean function a challenging task on both the theoretical and the practical side. Here we propose a method based on local linear smoothing that is implemented in the sparse (i.e., low number of nonzero coefficients) modelling situation. An SCC is constructed based on recent results obtained in applied probability theory. The precision and performance is demonstrated in a spectrum of simulations and applied to growth curve data. Technically speaking, our paper intensively uses recent insights into extreme value theory that are also employed to construct a shoal of confidence intervals (SCI).
1. Introduction. Longitudinal or functional data analysis (FDA) is a central piece of statistical modelling. A well known application is growth curve analysis in biology, medicine and chemistry, see e.g. Mu¨ller (2009), James, Hastie and Sugar (2000), Ferraty and Vieu (2006) and the references there. Groundbreaking theoretical work on functional data analysis has been done among others by
This research was supported by the Deutsche Forschungsgemeinschaft through the CRC 649 "Economic Risk", NSF Awards DMS 0706518, DMS 1007594, an MSU Dissertation Continuation Fellowship, and a grant from Risk Management Institute, National University of Singapore.
AMS 2000 Classification: Primary 62G08; secondary 62G15 JEL Classification: C14, C33 Keywords and phrases: Longitudinal data, confidence band, Karhunen-Lo`eve L2 representation, local linear estimator, extreme value, double sum, strong approximation.
1

2 S. ZHENG, L. YANG AND W. K. HA¨ RDLE Cai and Hall (2006), Cardot, Ferraty and Sarda (2003). Much of this work though is devoted to coefficient estimation, semiparametric analysis or dimension reduction methods. Research on statistical inference on the mean curve for example is rather scarce although it is potentially important for characterization of global properties. To characterize global properties of the unknown function of interest, the simultaneous confidence corridor (SCC) and the shoal of confidence intervals (SCI) are puissant instruments. They can be applied to test the overall trend or shape of the mean function. Such decisions are critical e.g. in ozone analysis, see Lucas and Diggle (1997) for a longitudinal study on Sitka spruce. They have pointed out that, in order to assess the cumulative effect of ozone pollution on spruce, an inference on the mean function of spruce growth during the entire experiment rather than at the end of the growth is required. This is one of the many other motivations to develop a new method and its theory to construct an SCC for the mean function of sparse longitudinal data where the measurements are randomly located with random repetitions.
The SCC methodology has been extensively studied in the literature. For the nonparametric regression, see Fan and Zhang (2000) and references there. In this strand of literature though it is not assumed that for family of curves one needs to take care of dependence structures. Wu and Zhao (2007) recently constructed a confidence band for the non-stationary mean function, and Wang and Yang (2009), Song and Yang (2009) obtained the spline-based analogy for the mean and variance functions. Nonparametric time series with specific dependence structures are considered in Zhao and Wu (2008). An SCC construction for longitudinal data remains however an open problem.
The major difficulty to construct the SCC for longitudinal data is that the observations within subject are dependent. In this situation, the "Hungarian embedding", used to construct confidence bands is no longer applicable. The sparse longitudinal data situation has been considered by Yao et al. (2005a) for individual trajectories instead of the mean function, while Yao (2007) obtained an SCI for the mean and covariance functions. Ma et al. (2010) constructed the first SCC of the mean function for the sparse longitudinal data through piecewise constant spline. The constructed SCC, however, is nonsmooth and

A CONFIDENCE CORRIDOR FOR SPARSE LONGITUDINAL DATA CURVES

3

its convergence rate to the true mean function has suboptimal rate. Here we propose to construct the SCC for the mean function of the sparse longitudinal data via local
linear smoothing. We tackle with this research a variety of interesting issues. First, the proposed SCC allows for the global rather than pointwise inference. Second, the sparse rather than dense longitudinal data setting requires more sophisticated extreme value theory. Third, compared to the piecewise constant spline method of Ma et al. (2010), different extreme value results are employed for a local linear estimator that leads to higher accuracy, better coverage, smooth mean curve and smooth SCC, all of which are desirable in the application.
We organize our paper as follows. In Section 2, we state our model and local linear smoothing methodology. In Section 3, we investigate the asymptotic distribution of the maximal deviation of the local linear estimator from the true mean function, which is used to construct the SCC. Section 4 outlines the key procedures to implement the SCC. Section 5 illustrates the performance of the SCC through extensive simulations followed by an empirical example in Section 6 which illustrates the SCC application on growth curve data. Technical proofs are presented in the Appendix.

2. Model and Methodology. Longitudinal data has the form of {Xij, Yij} , 1  j  Ni, 1  i 

n, in which Xij  X = [a, b] is the j-th random time point for the i-th subject and Yij is the response

measured at Xij. For the i-th subject, the sample path is the noisy realization of a continuous time

stochastic process i (x), namely,

Yij = i (Xij ) +  (Xij ) ij ,

(2.1)

where the errors ij are i.i.d. with E ij = 0, E i2j = 1, and {i (x) , x  X } are i.i.d. copies of the process 
{ (x) , x  X } with E X 2 (x) dx < +.
Denote by m (x) = E  (x) the regression curve and by G (x, x) = Cov { (x) ,  (x)} the covariance

operator with the Karhunen-Lo`eve L2 representation

 i (x) = m (x) + k=1 ikk (x) ,

(2.2)

4 S. ZHENG, L. YANG AND W. K. HA¨ RDLE

one has the random coefficients {ik}k=1 uncorrelated with mean 0 and variance 1. Here k (x) =

 kk (x) ,

where

{k }k=1

and

{k (x)}k=1

are

respectively

the

eigenvalues

and

eigenfunctions

of

G (x, x) such that 1  2  . . .  0 and {k}k=1 forms an orthonormal basis of L2 (X ). There-

fore,

G

(x, x)

=


k=1

k

(x)

k

(x)

and



G (x,

x)

k

(x)

dx

=

k k

(x).

In applications, the number of eigenfunctions k (x) , k = 1, 2, ... needs to be chosen by some criterion,

see Yao et al. (2005a). In the sparse curve data situation, many practical studies have shown that fitting

too many eigenfunctions can heavily degrade the overall fit, see e.g. James, Hastie and Sugar (2000).

Hence, in what follows, we assume that k = 0 if k > , where  is a positive constant. Equations (2.1)

and (2.2) can then be written as:

 Yij = m (Xij ) + k=1 ikk (Xij ) +  (Xij ) ij .

(2.3)

For convenience, we denote the conditional variance of Yij given Xij = x as

Y2 (x) = G (x, x) + 2 (x) = Var (Yij |Xij = x ) .

(2.4)

We are interested in the sparse situation where the number of measurements Ni within subject are

i.i.d. copies of a positive random integer N1, see Yao et al. (2005a), Yao et al. (2005b), Yao (2007).

To introduce the estimator, denote by K a kernel function, h = hn > 0 a bandwidth and Kh (x) =

h-1K

(x/h).

Let

NT

=

n
i=1

Ni

be the total sample size and define Y = (Yij)1jNi,1in the NT × 1

vector of responses. For any x  [0, 1], let X = X (x) = (1, Xij - x)1jNi,1in be the design matrix for linear regression and W = W (x) = NT-1 diag {Kh (X11 - x) , · · · , Kh (XnNn - x)} the kernel weight

diagonal matrix. Following Fan and Gijbels (1996), local linear estimators of m (x) and m (x) are

{m (x) , m (x)}T = arg min{Y - X(a, b)T}TW{Y - X(a, b)T}
a,b
= (XTWX)-1 XTWY.

Consequently, with e0T = (1, 0), m (x) is written as m (x) = e0T (XTWX)-1 XTWY,

(2.5)

A CONFIDENCE CORRIDOR FOR SPARSE LONGITUDINAL DATA CURVES

where the dispersion matrix 
XTWY = diag (1, h)  sn,0 sn,1


sn,1  diag (1, h) , sn,2

has for any nonnegative integer l,



sn,l = sn,l(x) = NT-1

Kh (Xij - x) {(Xij - x) /h}l .
i,j

5 (2.6) (2.7)

3. Main Results. Without loss of generality, assume X = [0, 1] and consider the assumptions:

(A1) The mean function m (x)  C2[0, 1], i.e. twice continuously differentiable. (A2) {Xij}i=,1,j=1 are i.i.d. with a probability density f (x). The functions f (x) ,  (x) and k  C1[0, 1]
with f (x)  [cf , Cf ] ,  (x)  [c, C] and all involved constants are finite and positive. (A3) The numbers of observations Ni, i = 1, 2, . . . are i.i.d. random positive integers with E N1r 
r!cNr , r = 2, 3, . . . for some constant cN > 0. (Ni)i=1 , (Xij )i=,1,j=1 , (ik)i=,1,k=1 , (ij )i=,1,j=1 are independent, while {ik}i=,1,k=1 are i.i.d. N (0, 1). (A4) There exists r > 5, such that E |11|r < . (A5) The bandwidth h = hn satisfies nh4  , nh5 log n  0 and h < 1/2.
(A6) The kernel function K (x) is a symmetric probability density function supported on [-1, 1] and  C3[-1, 1].

Assumptions (A1), (A2), (A5) and (A6) haven been postulated in many papers related to kernel

smoothing. (A3) has been used in Yao et al. (2005a). (A4) can be found also in Ma et al. (2010).

For a nonnegative integer l and a continuous function L (x), define:

  µl,x (L) = 

1
-x/h

vlL

(v)

dv,

µl

(L)

=

1
-1

vlL

(v)

dv,

 (1-x)/h
-1

vl

L

(v)

dv,

x  [0, h) x  [h, 1 - h] x  (1 - h, 1]

(3.1)

Dx (L) = µ2,x (L) µ0,x (L) - µ12,x (L) ,

(3.2)

6 S. ZHENG, L. YANG AND W. K. HA¨ RDLE and the equivalent kernel function, see Fan and Gijbels (1996):

Kx (u) = K (u) {µ2,x (K) - µ1,x (K) u} Dx-1 (K) , Kx,h (u) = Kx (u/h) /h where Dx-1 (K) exists by Lemma A.5. One may verify:
µ0,x (Kx) = 1, µ1,x (Kx) = 0 Dx (K) = µ2 (K) , Kx (u)  K (u) , x  [h, 1 - h] .

(3.3)

The asymptotic variance function is:

n2 (x) d=ef

Kx22 Y2 (x) nhf (x) E N1

[ 1+

() E N12 - N1 G (x, x) f (x) h

E N1

Y2 (x) Kx22

+

µ1,x

(Kx2

)

{ Y2

(x) f

(x)}

Kx22 Y2 (x) f (x)

h

]

.

Define z1-/2 d=ef -1 (1 - /2) and

Qh()

d=ef

ah

+

a-h 1[log{C

(K )/

(2)}

-

log{-

log

 1

-

}]

with

ah

=

 -2

log

h,

C

(K )

=

{-11

K

(x)2

dx}{-11

K2

(x)

dx}-1.

(3.4) (3.5)

THEOREM 3.1. Under Assumptions (A1)-(A6), for any   (0, 1)

lim
n

P{supx[0,1]

|m

(x)

-

m

(x)|

/n

(x)



Qh()}

=

1

-

,

lim
n

P{|m

(x)

-

m

(x)|

/n

(x)



z1-/2}

=

1

-

,

x



[0,

1]

,

with n2 (x) and Qh() given in (3.4) and (3.5).

By Theorem 3.1, we construct the SCC and SCI for m(x) as follows,

COROLLARY 3.1. Assume (A1)-(A6). A 100 (1 - ) % simultaneous confidence corridor (SCC)

for m (x) is:

[m (x) ± n (x) Qh()] .

(3.6)

A shoal of confidence intervals (SCI) is given by: [] m (x) ± n (x) z1-/2 .

(3.7)

A CONFIDENCE CORRIDOR FOR SPARSE LONGITUDINAL DATA CURVES

7

A simple approximation of n2 (x) is given by:

n2 ,IID

(x)

=

Kx22 Y2

(x) .

nhf (x) E N1

(3.8)

PROPOSITION 3.1. Given (A2), (A3) and (A6), then supx[0,1] n-1 (x) n,IID (x) - 1 = O (h) .

Using n2,IID (x) instead of n2 (x) is equivalent to treat {Xij, Yij} , 1  j  Ni, 1  i  n as i.i.d data, which implies that the longitudinal dependence structure is negligible in case of sparsity. This was also observed by Ma et al. (2010), Wang et al. (2005).

4. Implementation. Now we outline the construction of the SCC and SCI. Recall the definition

of m (x). The practical implementation of (3.6) and (3.7) is via estimating E N1, f (x) and Y (x),

see Wang and Yang (2009) and references therein. The quantity E N1 is estimated by NT/n and the

estimator of the density f (x) is

f

(x)

=

NT-1

n
i=1

Ni
j=1

Kh

(Xij

-

x)

.

(4.1)

The local linear estimator Y (x) = a1 results from:

( a1,

) b1

=

arg

min
a1 ,b1

n
i=1

Ni
j=1

{2ij

-

a1

-

b1

(Xij

-

x)}2

wij ,

where ij = Yij - m (Xij), wij = NT-1Kh (Xij - x) and h = NT-1/5 (log n)-1 satisfying (A5). The

consistency of f (x) and Y (x) is proved e.g. in Li and Hsing (2010), Yao et al. (2005a). Therefore, the

SCC m (x) ± ^n,IID (x) Qh() and the SCI m (x) ± ^n,IID (x) z1-/2 both have asymptotic confidence

level 1 - .

5. Monte Carlo Studies. This section checks the finite sample performance of the SCC. The data are generated from (2.1) with  = 2:
2 Yij = m (Xij ) + k=1 ikk (Xij ) +  (Xij ) ij , with m (x) = sin {2 (x - 1/2)}, 1 (x) = -0.2 cos { (x - 1/2)}, 2 (x) = 0.1 sin { (x - 1/2)},  (x) = exp{3(x - 0.5)2}/[1 + exp{3(x - 0.5)2}] and X  U [0, 1] , k  N (0, 1) , ij  N (0, 1), while Ni has a

8 S. ZHENG, L. YANG AND W. K. HA¨ RDLE

discrete uniform distribution from 5, . . . , 15 and n varies: 20,50,100,200. The confidence level is set to: 1 -  = 0.95, 0.99.
(Insert Figure 1 "Dataplot and trajectories" about here)

Table 1 Empirical coverage from 200 replications

n 1 -  = 0.95 1 -  = 0.99

20 0.925

0.965

50 0.940

0.980

100 0.950

0.995

200 0.955

0.990

The empirical coverage is reported in Table 1. The data are displayed in Figure 1. Clearly, the coverage approaches the nominal confidence levels as n increases, see Theorem 3.1. Coverage frequencies remain stable if the bandwidths' slightly vary. In practice, one can choose bandwidths adaptively to achieve better performance. The theoretical study of this issue would require too much space here. We therefore do not pursue this. Figure 2 plots the SCCs with 95% and 99% confidence levels. The above studies have illustrated the reliability of our method, which actually ensures the application of the SCC including the true curve for the real data in Section 6.
(Insert Figure 2 "The 95% and 99% SCCs of the mean curve" about here)

6. Application. Now we apply the SCC and SCI to a longitudinal study of growth curve data. The data curve analysis is a key in the studies of human skeletal health. These data consist of measurements Yij, spinal bone mineral density (g/cm2), for n = 286 people. However, Ni, the number of measurements for each individual, is between 2 and 4 (sparsity), and Xij, the time points of measurements (aged 8.8­ 26.2 yr), varies among individuals.
An earlier study of the growth curve data in James, Hastie and Sugar (2000) developed the pointwise inference of the mean function. Using the bootstrap method, they constructed the confidence intervals to test the mean curve at points of interest, e.g. the fastest growth point at about 15 yr. In our study, this task can be also done via constructing the SCI by (3.7). However, its computation is much faster than the bootstrap procedures. Furthermore, we will use the SCC to examine the global shape of the mean

A CONFIDENCE CORRIDOR FOR SPARSE LONGITUDINAL DATA CURVES

9

curve on the whole domain, such as the upward or downward trend at different stages, the acceleration or plateau during different periods.
(Insert Figure 3 "Growth curve data and the SCCs & SCIs of its mean curve" about here) Figure 3 (a) exhibits the scatter plot of the spinal bone density v.s. the age. Figure 3 (b), (c) and (d) depict the SCCs and SCIs of the population mean of the growth curve data, at the confidence levels of 90%, 95% and 99%, respectively. For the pointwise inference, James, Hastie and Sugar (2000) and our method share similar SCIs. However, testing the global shape of the growth curve, the constructed SCCs can indicate that the spinal bone density at mean level increases with age, but the bone growth is accelerated during early adolescence (9-15 yr) whereas it reaches the plateau during late puberty (16-26 yr). An R algorithm of our method has been provided on www.quantlet.org.

APPENDIX

.

A.1. Preliminaries. We introduce Lemmas (A.1)-(A.4) for the proof of Theorem 3.1 (Appendix A.2). For the details of Lemma A.1, see Cierco-Ayrolles et al (2003), Zheng, Yang and H¨ardle (2010).

LEMMA A.1. [Cierco-Ayrolles, Croquette and Delmas (2003)] Let X (t) be a Gaussian process

with almost surely C1 sample paths on [0, T ]. Then

P

{|X

(0)|

>

u}

+

E

[(UuX

[0,

T

]

+

D-Xu

[0,

T

) ]

I{|X (0)|

]
u}

-

1 2

E

(UuX

[0,

T

]

+

D-Xu

[0,

T ])[2]



P{supx[0,T ]

|X

(t)|

>

u}



P

{|X

(0)|

>

u}

+

E

[(UuX

[0,

T

]

+

D-Xu

[0,

T

) ]

I{|X (0)|

] u} .

(A.1)

LEMMA A.2. [Theorem 1 of Cierco-Ayrolles, Croquette and Delmas (2003)] Suppose X is a C1
real-valued Gaussian process defined on an interval I and {X (t) , X(s), X (t) , X (s)} is non-degenerate
t = s, (t, s)  I2. Then, denoting pV the probability density of a random vector V : 
E(UuX [I][2]) = I2 (0,)2 |x1 | |x2| pXt;Xs;Xt;Xs (u; u; x1; x2 ) dx1dx2 dtds,

10 S. ZHENG, L. YANG AND W. K. HA¨ RDLE

E

(UuX

[I ]

D-Xu

) [I ]

=



 +  0 |x1| |x2| pXt;Xs;Xt;Xs (u; -u; x1; x2) dx1dx2 dtds.

I2 0

-

LEMMA A.3. [Theorem 2.6.7 of Csorgo and R´ev´esz (1981)] Suppose that i, 1  i  n are i.i.d. with E 1 = 0, E 12 = 1 and H (x) > 0 (x  0) is an increasing continuous function such that x-2-H (x) is increasing for some  > 0 and x-1 log H (x) is decreasing with E H (|1|) < . Then there exist

constants C1, C2, a > 0 which depend only on the distribution of 1 and a sequence of Brownian motions

{Wn (t) , 0  t < }n=1 such that for any {xn}n=1 satisfying H-1 (n) < xn < C1 (n log n)1/2 and

Sk

=

k
i=1

i

P {max1kn |Sk - Wn (k)| > xn}  C2n {H (axn)}-1 .

LEMMA A.4. [Theorem 1.2 of Bosq (1996)]Suppose that i, 1  i  n are i.i.d. with 2 =

E 12, E 1 = 0 and there exists c > 0 such that for r = 3, 4, ..., E |1|r  cr-2r! E 12 < +, then for

each

n

>

1,

t

>

0,

P (|Sn|



 nt)



2 exp{-t2

(4

+

2ct/n)-1}.

A.2. Proof of Theorem 3.1. Throughout this section, for functions an (x) and bn (x), an (x) =

U{bn (x)} and an (x) = U {bn (x)} respectively means that, as n  , supx[0,1] |an (x) /bn (x)| = O(1)

and supx[0,1] |an (x) /bn (x)| = O (1). In addition, an (x) = Ua.s. {bn (x)} and an (x) = Ua.s. {bn (x)}

respectively means that, as n  , an (x) = U{bn (x)} and an (x) = U {bn (x)} almost surely, and Oa.s.,

Op, Oa.s., Op are similarly defined.

We denote m = (m (Xij)),  = ( (Xij) ij), k = (ikk (Xij)). The signal and noise decomposition

XTWY

=

XTWm

+


k=1

XTWk

+

XTW

implies

that,

m (x) - m (x) = m (x) - m (x) + e(x), 
e(x) = k=1 k(x) + (x),

(A.2)

where k(x) = e0T(XTWX)-1XTWk and (x) = e0T(XTWX)-1XTW.

The error structure in (A.2) allows one to investigate the asymptotics of supx[0,1] |e (x) /n (x)| and

supx[0,1] |{m (x) - m (x)} /n (x)| separately in Lemmas A.6-A.14, with n (x) given in (3.4).

A CONFIDENCE CORRIDOR FOR SPARSE LONGITUDINAL DATA CURVES

We introduce some more notations, defining

Dx =  µ2,x(K) -µ1,x (K )


-µ1,x(K)  , µ0,x (K )

with µl,x(K) given in (3.1) 
 (x) = f -1 (x) NT-1 i,j Kx,h (Xij - x)  (Xij ) ij , 
k (x) = f -1 (x) NT-1 i,j Kx,h (Xij - x) k (Xij ) ik, with Kx,h (u) given in (3.3)

11 (A.3)
(A.4) (A.5)

Rij, (x) = Kx,h (Xij - x) Dx (K)  (Xij ) ,

Rik,k

=

Ni
j=1

Kx,h

(Xij

-

x) Dx

(K) k

(Xij ) ,

(A.6) (A.7)

with Dx (K) given in (3.2)

 2,n (x) = f -2 (x) NT-2Dx-2 (K) i,j Ri2j, (x) ,

(A.8)

2k ,n

(x)

=

f -2

(x)

NT-2Dx-2

(K )

n
i=1

Ri2k,k

(x)

,

Cx (K )

=

µ0,x{Kx (x)2} µ0,x{Kx (x)2}

-

µ20,x {Kx (x) Kx (x)} µ20,x{Kx (x)2}

,

(A.9) (A.10)

where Kx (x) = dKx (x) /dx, µl,x (L) given in (3.1). It is easily verified that Cx(K) = C (K) , x 

[h, 1 - h] with C (K) given in (3.5).

LEMMA A.5. Under Assumptions (A5)-(A6), for x  [0, 1] 0 < D0 (K)  Dx (K)  D1/2 (K) = µ2 (K) < +,
while supx[0,1] |Cx(K)| < . Proof. See Appendix B, Zheng, Yang and H¨ardle (2010).

(A.11)

12 S. ZHENG, L. YANG AND W. K. HA¨ RDLE

LEMMA A.6. Under Assumptions (A1)-(A6), for Dx (K) given in (3.2) and Dx in (A.3),

(XTWX)-1

=

f -1(x)

diag

( 1,

h-1

)

{Dx-1

(K )

Dx

+

1,n

} (x)

diag

( 1,

h-1)

 as n  , where the 2 × 2 random matrices 1,n (x) = U (h) + Ua.s.{ log n/(nh)}.

Proof. For notational simplicity, let x  [h, 1 - h], we investigate sn,l (x) , l = 0, 1, 2, given in (2.7).

|sn,0 (x) - f (x)|  n(E N1)NT-1 - 1

(n E N1)-1 n Ni Kh (Xij - x) +
i=1 j=1

|E Kh (Xij - x) - f (x)| + (n E N1)-1 n Ni Kh (Xij - x) - E Kh (Xij - x)
i=1 j=1

(A.12)

= I1 (x) + I2 (x) + I3 (x) .

Clearly,

I2

(x)

=

U

() h2

and

E

{Kh

(Xij

-

x)}r

=

U

(h1-r )

for

r



2.

Define

I3(x)

=

(n

E N1)-1

|

n
i=1

i,h|

with

i,h

=

Ni
j=1

Kh

(Xij

-

x)

-

E Kh

(Xij

-

x) E

N1.

For

large

n,

E |i,h|r = E Ni

Kh (Xij - x) - E Kh (Xij - x) E N1

r


j=1

(A.13)

2r-1[E{Ni Kh (Xij - x)}r + {E Kh (Xij - x) E N1}r] 

2r

E{Ni
j=1
[

Kh

(Xij

-

j=1
x)}r

=

2r

E

 r1+...+rNi =r

(



0r1

,...,rNi

r
]

r1

r ...rNi

)

Ni
i=1

E

{Kh

(Xij

-

 x)}ri 

 2r E

Nir

r1+.m..+arxNi =r
0r1,..., rNi r

Ni
i=1

E

{Kh

(Xij

-

x)}ri

 2r (E N1r) Crh1-r  C r!h1-r.

It can be next verified that E (i,h)2 = (E N1) h-1f (x)  K2 (v) dv {1 + U(1)}. Hence,  C > c > 0

such

that

c h-1

<

E (i,h)2

<

C h-1

,

i.e.,

E |i,h|r



cr-2r! E (i,h)2

with

c

=

(C

/c

)

1 r-2

h-1

,

see

(A.13). In fact, it implies {i,h}ni=1 satisfies Cram´er's Condition. Therefore, applying Lemma A.4 to

n
i=1

i,h,

for

large

n

and

large



>

0,

one

shows

 P{I3 (x) >  log n/ (nh)} 

2 exp[- (E N1)2

2

log n{4C

+

2

E N1

( C

/c

)1/(r-2)

 log n/ (nh)}-1]



2n-C2



2n-8.

A CONFIDENCE CORRIDOR FOR SPARSE LONGITUDINAL DATA CURVES

13

Now discretize h = x0 < x1 < · · · < xMn = 1 - h with Mn = n4 and then,

P{maxjM=n0

I3

(xj

)

>

  log

n/

(nh)}



Mn
j=0

P

{|I3

(x)|

>

  log

n/

(nh)}



2n-4,

and

hence

the

Borel-Contelli

Lemma

implies

that

maxMj=n0

I3

(xj )

=

 Oa.s.{ log

n/(nh)}.

It

is

also

clear

that,

supx[h,1-h] I3 (x)  maxMj=n0 I3 (xj ) + maxjM=n0-1 supx[xj,xj+1] |I3 (xj ) - I3 (x)|



 Oa.s.{ log

n/(nh)}

+

U

{ (1

-

2h)

/

(nh4)}

=

 Oa.s.{ log

n/(nh)},

which by the definition of I3 (x) implies that

(n E N1)-1 n

Ni

 Kh(Xij - x) = E Kh(Xij - x) + Ua.s.{ log n/(nh)}

i=1 j=1

 = f (x) + U (h2) + Ua.s.{ log n/(nh)}.

(A.14)

 Applying Lemma A.4 for NT, one has |(n E N1) /NT - 1| = Oa.s{ log n/n} and (A.14) also implies



()



that sup I1(x) = Oa.s.( log n/n). Now, by (A.12), sn,0 (x) = f (x) + U h2 + Ua.s.{ log n/(nh)}.

x[h,1-h]





Similarly, sn,1 (x) = U (h) + Ua.s.{ log n/(nh) }and sn,2(x) = f (x)µ2(K) + U (h) + Ua.s.{ log n/(nh)}

which imply that XTWX can be written as

 f (x) diag(1, h)[diag {1, µ2(K)} + U (h) + Ua.s.{ log n/(nh)}] diag(1, h).

Finally, the inverse of this matrix is concluded as this lemma. ()
LEMMA A.7. Under Assumptions (A1)-(A6), as n  , m (x) - m (x) = Oa.s. h2 .

Proof. See Proof of Theorem 6.5, page 268 of Fan and Yao (2005).

LEMMA A.8. Under Assumptions (A1)-(A6), for  (x) and k (x) given in (A.4) and (A.5),



e (x) = {1 + 2,n (x)} { (x) +

k (x)}

k=1

 as n  , where the 2 × 2 random matrices 2,n (x) = U (h) + Ua.s.{ log n/(nh)}.

14 S. ZHENG, L. YANG AND W. K. HA¨ RDLE

Proof.

For

notational

simplicity,

let

x



[h, 1 - h],

therefore

 (x)

+


k=1

k

(x)

=

f -1(x)T0(x)

with Tl, l = 0, 1 defined as

Tl

(x)

=

NT-1


i,j

Kh

(Xij

-

x)

{(Xij

-

x)

/h}l

{

(Xij )

ij

+


k=1

k

(Xij )

ik }.

Lemma A.6 shows that for 1,n (x) given in Lemma A.6

e(x)

=

f

-1(x)e0T

diag

( 1,

h-1)

[ diag

{ 1,

µ2-1(K

} )

+

1,n

] (x)

{T0

(x)

,

T1

(x)}T,

i.e., e(x) = {1 + 1,n (x)} f -1 (x) T0 (x). Therefore, this lemma holds.

Let

Xij , 1



i



n,

1



j



Ni

be

descendingly

ordered

as

X(t),

1



t



NT,

Sq

=

q
t=1

(t)

where

(t) is corresponding in index to X(t).

LEMMA A.9. Given (A1)-(A6), then there exists a sequence of Wiener processes {WNT (t)}tN=T1

independent of {Ni, Xij, i 1  i  n, 1  j  Ni, 1  k  } such that as n   and for some

t > 2/5

 (x) - NT (x) = Oa.s.(n-t ),

with

NT

(x) = {NTf

(x)}-1

NT
t=1

Kx,h

( X(t)

-

) x



() X(t) {WNT

(t)

-

WNT

(t

-

1)}.

Proof. Without loss of generality, let x  [h, 1 - h]. By Lemma A.3, let H (x) = xr, r > 5 (As-

sumption

A4)

and

xn

=

ns, s



(2r-1

,

) 2/5 .

It

is

easy

to

verify

that

{ (t)

}NT
t=1

satisfies

the

conditions

of

Lemma A.3 and nH-1 (axn) = a-rn1-rs = O(n-s ) for some s > 1. Therefore, there exists a sequence

of Wiener process {WNT (t)}tN=T1 independent of {Ni, Xij, i 1  i  n, 1  j  Ni, 1  k  } such that P {MNT > ns}  C2n-s with MNT = max1qNT |Sq - WNT (q)| and hence Borel-Cantelli

Lemma warrants that MNT = Oa.s (ns).

A CONFIDENCE CORRIDOR FOR SPARSE LONGITUDINAL DATA CURVES

15

The technique of summation by parts implies that

sup

| (x) - NT (x)| 

sup

NT-1cf-1|Kh

( X(NT)

-

) x



() X(NT)

{WNT (NT)

-

SNT }

(A.15)

x[h,1-h]

x[h,1-h]

+

NT-1{Kh
t=1

( X(t)

-

) x



() X(t)

-

Kh

( X(t+1)

-

) x



() X(t+1) }



h-1MNT NT-1cf-1×

sup [
x[h,1-h]

3CK C

+

X(t) [x-h,x+h]
1tNT -1

( |K{ X(t)

-

) x

/h}

() X(t)

-

( K{ X(t+1)

-

) x

/h}

() X(t+1)

|

].

Since |ab - cd|  |a||b - d| + |b||a - c| + |a - c||b - d|, (A.15) is bounded by

h-1MNT NT-1cf-1

sup [
x[h,1-h]

3CK C

+

X(t) [x-h,x+h]
1tNT -1

2CK ×

() (

)

()

(

)

| X(t) -  X(t+1) | + C|K{ X(t) - x /h} - K{ X(t+1) - x /h}| ].

Therefore,  constants L1K,, LK2 ,, C and C such that (A.15) is bounded by

h-1MNT NT-1cf-1

sup (
x[h,1-h]

3CK C

+

L1K,

X(t) [x-h,x+h]
1tNT -1

|X(t)

-

X(t+1)|+

LK2 ,h-1

X(t) [x-h,x+h]
1tNT -1

|X(t)

-

X(t+1)|

)



h-1MNT NT-1

(C

+

C  h)

.

Namely supx[h,1-h] | (x) - NT (x) | = Oa.s(h-1ns-1) and by assumption (A5), one obtains

sup

|NT (x) -  (x)| = Oa.s.(n-t ),


t

> 2/5.

x[h,1-h]

This completes the proof.

LEMMA A.10. Under Assumptions (A1)-(A6), as n  ,



NT-1

i,j Ri2j, (x) - E R121, (x)

 = Oa.s.{ log n/ (nh)},


NT-1

n
i=1


k=1

Ri2k,k

(x)

-

(E

N1)-1


k=1

E

R12k,k

(x)

 = Oa.s.{ log n/ (nh)},


with Rij, (x) and Rik,k (x) given in (A.6) and (A.7).

16 S. ZHENG, L. YANG AND W. K. HA¨ RDLE

Proof. Without loss of generality, let x  [h, 1 - h]. Clearly,

sup
x[h,1-h]

NT-1

n
i=1


k=1

Ri2k,k

(x)

-

(E

N1)-1


k=1

E

Ri2k,k

(x)



(E

N1)-1


k=1

sup
x[h,1-h]

n-1

n
i=1

Ri2k,k

(x)

-

E

Ri2k,k

(x)

+

(E N1)-1 

sup

k=1 x[h,1-h]

n(E N1)NT-1 - 1

n-1

n
i=1

Ri2k,k

(x)

.

It is next straightforward to verify Cram´er's Condition for Ri2k,k (x) = Ri2k,k (x) - E Ri2k,k (x),

i.e., E{Ri2k,k (x)}r  cr-2r! E Ri2k,k (x) with r  2 and c  h-1. Again, by Lemma A.4, one

has supx[h,1-h]

n-1

n
i=1

Ri2k,k

(x)

-

E

Ri2k,k

(x)

=

 Oa.s.{ log n/ (nh)},

i.e.,

n-1

n
i=1

Ri2k,k

(x)

=

U

(h-1)

+

 Ua.s.{ log

n/

(nh)}.

Therefore,

sup
x[h,1-h]

NT-1

n
i=1


k=1

Ri2k,k

(x)

-

(E

N1)-1


k=1

E

Ri2k,k

(x)

 = Oa.s.{ log n/ (nh)}.

The proof for Ri2j, (x) is similar.

Throughout the remainder, define the standardized noise processes as

n

(x)

=



(x)

=

{NT

(x)

+


k=1

k

(x)}{2,n

(x)

+


k=1

2k ,n

(x)}-1/2,

x



[0,

1]

(A.16)

with NT (x) , k (x) , 2,n (x) and 2k,n (x), respectively, given in Lemma A.9, (A.5), (A.8) and (A.9). For any n and fixed x ,

L { (x) | (Xij, Ni) , 1  j  Ni, 1  i  n} = N (0, 1) ,

and hence L { (x)} = N (0, 1) which implies  (x) is a standardized Gaussian process.

To compute the extreme value of  (x) by Lemma A.1, one needs to study its correlation function. In

the

following,

denote

xh-1

=

t



[ 0,

h-1],

mt

=

m(t)

=

E

(t),

r

(t,

s)

=

E



(t) 

(s)

,

rt

=

r

(t, t)

, r0t

=

r (0, t) , r1,0 (t, s) = r (, ) /|(t,s) , r1,1 (t, s) = 2r(, )/ (t,s) , r1,1(t, s) =  E  (t)  (s) /ts,

t,

s



[ 0,

h-1]

and

C (t)

d=ef

Cth

(K )

,

t



[ 0,

h-1],

with

Cth

(K )

as

in

(A.10),

so

that

C (t)



C

(K )

,

t



[ 1,

h-1

-

] 1.

Clearly,

for

any

n,

m (t) = 0, r (t, t) = rt  1.

(A.17)

A CONFIDENCE CORRIDOR FOR SPARSE LONGITUDINAL DATA CURVES

and

it

is

easy

to

verify

that

for

t



[ 0,

h-1]

17

r1,0 (t, t) = 0,

(A.18)

while

for

v2

=

Var { (t) | (0) ,  (t)},

see

(15)

in

Zheng,

Yang

and

H¨ardle

(2010),

s, t



[ 0,

h-1]

and

|t - s|  2,

rst = r1,0 (t, s) = 0, v2 = r1,1 (t, t) .

(A.19)

LEMMA A.11. Under Assumptions (A1)-(A6)

lim
n

sup
t[0,h-1 ]

|r1,1(t,

t)

-

C (t)|

=

0.

There exist constants 0 < c < C < , 1 >  > 0, such that for large n

(A.20)

inf r (t, s)  -1 + c > -1, sup r (t, s)  1 - c < 1,

t,s[0,h-1 ],|t-s|<2

2>|t-s|, t,s[0,h-1]

(A.21)

sup max[r1,0 (t, s) / (t - s) , {1 - r2 (t, s)}/ (t - s)2]  C,
0<|t-s|<,t,s[0,h-1 ]
inf min[r1,0 (t, s) / (t - s) , {1 - r2 (t, s)}/ (t - s)2]  c,
0<|t-s|<,t,s[0,h-1 ]

()

sup
0<|t-s|<,t,s[0,h-1 ]

r1,1

(t,

t)

-

r12,0 (t, s) (t - s)2

/

1 - r2

 C,

()

inf
0<|t-s|<,t,s[0,h-1 ]

r1,1

(t,

t)

-

r12,0 (t, s) (t - s)2

/

1 - r2

 c,

sup |r12,0(t, s)/{1 - r2(t, s)}|  C
|t-s|<2,t,s[0,h-1 ]
inf  |r1,0 (t, s) / (1 + r)|  c |t-s|<2,t,s[0,h-1] r1,1 (t, t) - r12,0 (t, s) / (1 - r2)

Proof. See Appendix C, Zheng, Yang and H¨ardle (2010).

(A.22)
(A.23) (A.24) (A.25)

In what follows, the "double sum" method of Piterbarg (1996) will be applied to study the extreme

value

distribution

of

the

sequence

of

Gaussian

processes



(t)

over

the

growing

interval

[ 0,

h-1

] .

Partition

18 S. ZHENG, L. YANG AND W. K. HA¨ RDLE

the

interval

[ 1,

h-1

] -1

as

1

=

a1

<

b1

<

a2

<

b2

<

···

<

aN

<

bN

=

h1

-

1,

assuming

Il

=

[al,bl] , l

=

1, · · · , N, Il = [bl, al+1] , l = 1, · · · , N - 1 and the length of Il and Il are n and 2, respectively, where

(n + 2) N = h-1 and n  , N   as n  .

 LEMMA A.12. Under Assumptions (A1)-(A6), for u = un satisfying 2 C (K)N n (un)  (0)  - log (1 - ) with C (K) given in (3.5)

lim
n

P{supt[0,1)lN=-1 1 Il (h-1 -1,h-1 ]

|

(t)|}



u

=

1.

Proof. In Lemma A.1, for  [a, b]  [0, h-1], one computes according to Cierco-Ayrolles et al (2003), Zheng, Yang and H¨ardle (2010)

E

[(Uu

[a,

b]

+

D- u

[a,

) b]

] I{|X (a)|u}

=

(A.26)

2

(u)

{ 

(0)

b
a

 r1,1

(t,

t)dt

-

b
a

( 

(0)

 r1,1

(t,

t)

[ 1

-



{ r1,1

(t,

 t)

1 1

- +

rat rat

u v

}]

[ 1

-

+ r1,0 (t, a) 1 - ra2t
{
 r1,1 (t,

( 1
 1
 1+
t) 1 -

- rat + rat
rat u rat v

) u
}]

 -

{

r1,0 (t, a) 1 + rat

u v

})

dt

-

b
a

( 

(0)

 r1,1

(t,

( ) {

r1,0 (t, a)  1 - ra2t

1 1

+ -

rat rat

u



-r1,0 (t, a) 1 - rat

t)× })
u v

} dt

.

According to (A.20) and (A.24), it is clear that as n  ,

sup

E

[(Uu

[bl,

bl

+

2]

+

D- u

[bl,

bl

+

) 2]

] I{|X (bl )|u}

=

O

{

(u)}

.

1lN -1

 Hence, the upper bound of (A.1) shows that, if 2 C (K)N n (un)  (0)  - log (1 - ) as n  ,

N -1 l=1 P{supIl | (t)| > u} = O [2N {1 -  (u)}] + O {N  (u)} = O(1) ,

Similarly,

while

t



[0, 1)



(h-1

-

1,

h-1

] ,

one

can

show

that

(A.27)

P{supt[0,1)(h-1-1,h-1] | (t)| > u} = O {1 -  (u)} + O { (u)} = O(1) .

(A.28)

A CONFIDENCE CORRIDOR FOR SPARSE LONGITUDINAL DATA CURVES
Finally, this lemma is proved by
P{supt[0,1)Nl=1Il (h-1-1,h-1] | (t)| > u}  N -1
P{supt[0,1)(h-1-1,h-1] | (t)| > u} + l=1 P{supIl | (t)| > u}.

19

 LEMMA A.13. Under Assumptions (A1)-(A6), for u = un satisfying 2 C (K)N n (un)  (0)  - log (1 - ) with C (K) given in (3.5),

lim
n

P{supNl=1Il

|

(t)|



un}

=

1

-

.

Proof. First, in order to apply Lemma A.1, we rewrite

E

[(Uu

[al,

bl]

+

D- u

[al,

) bl]

] I{|X (al )|u}

=



al+2  +

bl

= I1l + I2l.

al al+2

Similar to Lemma A.12, one also can show that as n  ,

sup I1l = O { (u)} .
1lN

(A.29)

Further, since ralt = r1,0 (t, al) = 0, v2 = r1,1 (t, t) for t  [al + 2, bl], see (A.19), one can simplify

(A.26) as

 bl 

 bl 

I2l = 2 (u)  (0)

r1,1 (t, t)dt - 4 (u)  (0) {1 -  (u)}

r1,1 (t, t)dt,

al +2

al +2



hence if 2 C (K)N n (un)  (0)  - log (1 - ), as n  ,

 sup I2l - 2n (u)  (0) C (K) = O{ (u) n} .
1lN

(A.30)

Therefore, (A.29) and (A.30) show that

sup

E

[(Uu

[al

,

bl]

+

D- u

[al,

) bl]

] I{|X (al )|u}

-

2n

(u)



(0)

 C

(K

)

= O{ (u) n} .

1lN

(A.31)

Now consider the second order moment and it is easy to verify that

E (Uu

[al,

bl]

+

D- u

[al,

bl])[2]

=

2

E

Uu

[al, bl][2]

+

2

E

(Uu

[al,

bl]

D- u

[al,

) bl]

.

20 S. ZHENG, L. YANG AND W. K. HA¨ RDLE

By Lemma A.2 and the H¨older inequality



E Uu [al, bl][2]

(A.32)

= 

s,t[al ,bl ]2

(0,)2 |1 | |2 | pt;s;t ;s (u; u; 1 ; 2 ) d1 d2 dtds

= E{ (t)+  (s)+ | (t) =  (s) = u }p(t),(s) (u, u) dtds  s,t[al,bl]2

 E1/2[{ (t)+}2 | (t) =  (s) = u ] E1/2[{ (s)+}2 | (t) =  (s) = u ]p(t),(s) (u, u) dtds

s,t[al

,bl

]2






=+

+ = I1l + I2l + I3l,

2|s-t|,s,t[al ,bl ]2

 |s-t|<2,s,t[al ,bl ]2

|s-t|<,s,t[al ,bl ]2

where

p(t),(s)

(u, u)

=

 (2 1

-

r2)-1

exp

{ -u2/

(1

+

} r) ,

see

Aza¨is

and

Wschebor

(2009)

p.96,

Gaus-

sian Rice Formula, and   (0, 1) which does not depend on n, see Lemma A.11.

For I1l , it is cleat that

E

[ {

(t)+}2

|

(t)

=



(s)

=

u

]



E

[{

(t)}2

|

(t)

=



(s)

=

u

]

 E2 { (t) | (t) =  (s) = u } + Var { (t) | (t) =  (s) = u } ,

E { (t) | (t) =  (s) = u } = r1,0 (t, s) u/ (1 + r) ,

Var

{

(t)

|

(t)

=



(s)

=

u

}

=

r1,1

(t,

t)

-

r12,0

(t,

s)

/

( 1

-

r2)

,

(A.33) (A.34)

see Aza¨is and Wschebor (2009) p.96. If |t - s|  2, then rst = r1,0 (t, s) = 0 which implies that

E { (t) | (t) =  (s) = u } = 0 and Var { (t) | (t) =  (s) = u } = r1,1 (t, t). Hence

I1l




2|s-t|,s,t[al ,bl ]2

 r1,1

 (t, t) r1,1

(s,

1 s)
2

exp (-u2)

dtds,

which implies that

(A.35)

sup I1l = O{2 (u) n2 }.
1lN

For I2l , similarly,



I2l 

{r12,0 (t, s) u2/ (1 + r)2 + r1,1 (t, t)}1/2×

 |s-t|<2,s,t[al ,bl ]2

{r12,0

(s,

t)

u2/

(1

+

r)2

+

r1,1

(s,

s)}1/2

1 2 1 -

r2

exp{-u2/

(1

+

r)}dtds.

(A.36) (A.37)

A CONFIDENCE CORRIDOR FOR SPARSE LONGITUDINAL DATA CURVES

21

By (A.21), for large n , c > 0 such that sup|t-s|>0 (1 + r)  2 - c and inf|t-s|>0 1 - r2  c > 0, so  constants L1, K1 > 0 such that

sup I2l  L1 {(1 + K1) u} n.
1lN

(A.38)

One can bound I3l using the inequalities (4.10) and (4.11), Aza¨is and Wschebor (2009) p.97, i.e.,

for

Z



N

( µ,

2

) ,

if

µ

>

0,

E (Z+)2



µ2

+

2

and

if

µ

<

0,

E (Z+)2



(µ2

+ 2) {1 -  (-µ/)}

+

µ (µ/). Since  (t) ,  (s) conditioning on  (t) =  (s) = u have a joint Gaussian distribution, see

Aza¨is and Wschebor (2009) p.96, we denote

µ1 = E { (s) | (t) =  (s) = u } , µ2 = E { (t) | (t) =  (s) = u } ,

(A.39)

12 = Var { (s) | (t) =  (s) = u } , 22 = Var { (t) | (t) =  (s) = u } .

(A.40)

Next, we claim that while 0 < |s - t| <  , µ1 and µ2 have opposite signs. In fact, if 0 < |s - t| < , by

(A.22), for large n, r1,0 (t, s)  (t - s) and r1.0 (s, t)  (s - t) and by (A.21), inf|t-s|< (1 + r)  c > 0,

which imply that µ1µ2 < 0, see (A.33). Further, according to (A.25), (A.33) and (A.34), for large n,  constant L2 > such that inf|t-s|<2,t,s[0,h-1] |µ2| 2-1  L2u. Without loss of generality, by (A.39) and

(A.40), let µ1 > 0 > µ2, then

 I3l 

 µ12

+

12

[(µ22

+

22)

{1

-



(-µ2/2)}

+

|s-t|<,s,t[al ,bl ]2

µ22

(µ2/2)]1/2

1 2 1 -

r2

exp{-u2/

(1

+

r)}dtds.

It follows from (A.22) and (A.23) that for large enough n,  constants L3, L4, L5, K2 > 0 such that



sup I3l 

L3 (s - t)2 u2 + (s - t)2×

1lN

|s-t|<,s,t[al ,bl ]2

(A.41)

[{(s - t)2 u2 + (s - t)2} {1 -  (L2u)} - (s - t)2 u (-L2u)]1/2 |s - t|-1  (u) dsdt

 L5 {(1 + K2) u} n.  Hence, if 2 C (K)N n (un)  (0)  - log (1 - ), as n  , (A.36), (A.38) and (A.41) imply that

sup E Uu [al, bl][2] = O{ (u) n} .
1lN

22 S. ZHENG, L. YANG AND W. K. HA¨ RDLE

Similarly,

one

has

E

( Uu

[al,

bl] D- u

[al,

) bl]

=

o

{

(u)

n}

and

then

sup E (Uu [al, bl] + D- u [al, bl])[2] = O{ (u) n} .
1lN

In fact, by Lemma A.1, (A.31) and (A.42) show that, as n  ,

 P{supIl | (t)| > u} = 2 C (K) (u)  (0) n + O{ (u) n} .

(A.42) (A.43)

Finally, since E  (t)  (s) = 0 while t  Il, s  Im, l = m, then  (t) ,  (s) for t  Il, s  Im, l = m

are independent Gaussian processes and hence

N

P{supNl=1Il | (t)|  u} = l=1 P{supIl | (t)|  u}

N [

{

}]

N

[

]

=

l=1 1 - P supIl | (t)| > u = exp(

log
l=1

1 - P{supIl | (t)| > u}

)

N



= exp(

log[1 - 2
l=1

C (K) (u)  (0) n + O{ (u) n}])



= exp[-2N C (K) (u)  (0) n + O{N  (u) n}].

 Since 2 C (K)N n (u)  (0)  - log (1 - ) as n  , then it follows from the definitions of

N, n, un that limn P{supNl=1Il | (t)|  u} = 1 - . 
The quantile Qh () given in (3.5) satisfies 2 C (K)N n {Qh ()}  (0)  - log (1 - ), as n  ,

then Lemmas A.12 and A.13 imply that limn P{sup[0,1] | (x)|  Qh ()} = 1 - , i.e.,

[  ]

lim P
n

ah{sup[0,1] | (x)| - ah} - log{

C (K)/ (2)}  - log{- log

1 - } = 1 - .

 In particular, sup[0,1] | (x)| = Op( log n).

(A.44)

LEMMA A.14. Under Assumptions (A1)-(A6), let 3,n (x) = n (x) n-1 (x) - 1,x  [0, 1], then 
3,n (x) = U (h) + Ua.s.{ log n/(nh2)} and for  (x) , n2 (x) given in (3.4) as n  

sup
[0,1]

n-1

(x)

{NT

(x)

+


k=1

k (x)}

-



(x)

= sup |3,n (x)| | (x)|
[0,1]

 = Op{h log n + log 2n/(nh2)}.

A CONFIDENCE CORRIDOR FOR SPARSE LONGITUDINAL DATA CURVES

23

Proof. It follows from the definition of  (x) given in (A.16) that |3,n (x)| = n (x) n-1 (x) - 1  n2 (x) n-2 (x) - 1 in which

 n2 (x) = f -2 (x) Dx-2 (K) NT-1{NT-1 i,j Ri2j,(x) + NT-1 k,i Ri2k,k (x)}.

Lemma

A.10

implies

NT-1


i,j

Ri2j,(x)

=

E

Ri2j,(x)

+

 Ua.s{ log

n/(nh2)}

and

NT-1


k,i

Ri2k, (x)

=

(E

N1)-1


k=1

E

Ri2k,k

(x)

+

 Ua.s.{ log n/(nh2)}.

Also,

one

has

NT

=

n E N1

+

 Ua.s.( log n/n)

and

E

Ri2j,(x)

+

(E

N1)-1


k=1

E

Ri2k,k (x)

=

U

(h-1

) .

Therefore,

n2

(x)

=

f

-2

(x)

Dx-2

(K )

[(n

E

N1)-1

+

 Ua.s.( log

n/n)]×

[E

Ri2j,(x)

+

(E

N1)-1


k=1

E

Ri2k,k

(x)

+

 Ua.s.{ log

n/(nh2)}]

=

f

-2

(x)

Dx-2

(K )

(n

E

N1)-1

{E

Ri2j,(x)

+

(E

N1)-1


k=1

E

Ri2k,k

(x)}+

 Ua.s.( log

n/n){E

Ri2j,(x)

+

(E

N1)-1


k=1

E

Ri2k,k

(x)}

=

n2

(x)

+

 Ua.s.{ log

n/(nh2)},

 which implies that n2 (x) n-2 (x) = 1 + Ua.s.{ log n/(nh2)} and hence this lemma holds.

Proof Of Proposition 3.1. The proof is trivial.

Proof Of Theorem 3.1. The decomposition (A.2) implies that

n-1 (x) {m (x) - m (x)} = n-1 (x) {m (x) - m (x)} + n-1 (x) e(x).

(A.45)

 As (A.44) implies that sup[0,1] | (x)| = Op( log n), Lemma A.14 leads to

sup[0,1] n-1 (x)

 NT (x) + k=1 k (x)

 = Op( log n).

and hence by Lemma A.9, sup[0,1] n-1 (x)



(x)

+


k=1

k

(x)

 = Op( log n). Therefore, Lemma A.8

implies that

sup[0,1] n-1 (x)



e(x) - { (x) +

k (x)}

k=1

 = Op{h log n + log 2n/ (nh2)}.

(A.46)

It follows from (A.46), Lemmas A.9 and A.14 that for t > 2/5 (assumption A5 ),

sup[0,1]

n-1 (x) |e(x)| - | (x)|

=

 Op{h log

n

+

 log

2n/

(nh2)

+

hn-t+1/2},

24 S. ZHENG, L. YANG AND W. K. HA¨ RDLE Further, (A.46) and Lemma (A.7) warrants that

sup[0,1] n-1 (x) |m (x) - m (x)| - | (x)| =

Op{nh5/2

+

 h log

n

+

 log

2n/

(nh2)

+

hn-t+1/2},

(A.47)

and therefore

ah supx[0,1] n-1 (x) |m (x) - m (x)| - | (x)|

=

 Op[ log

h-1{nh5/2

+

 h log

n

+

 log

2n/

(nh2)

+

hn-t+1/2}]

=

Op

(1)

.

(A.48)

Finally, by Slutsky's Theorem, (A.44) and (A.48) show that

lim
n

P

[ ah{sup[0,1]

n-1

(x)

|m

(x)

-

m

(x)|

-

ah}

-

 log{ C

(K )/

(2)}



-

log

{ -

log

 1

-

}] 

= 1 - ,

which is

lim
n

P{supx[0,1]

n-1

(x)

|m

(x)

-

m

(x)|



Qh

()}

=

1

-

.

REFERENCES
Aza¨is, J.M. and Wschebor, M. (2009). Level Sets and Extrema of Random Processes and Fields. John Wiley & Sons, Inc., Hoboken, New Jersey.
Bosq, D. (1996). Nonparametric Statistics for Stochastic Processes: Estimation and Prediction. Springer-Verlag, New York.
Cai, T. and Hall, P. (2006) Prediction in functional linear regression. Annals of Statistics 34, 2159-2179.
Cardot, H., Ferraty, F. and Sarda, P. (2003). Spline estimators for the functional linear model. Statistica Sinica 13 571­591.
Cierco-Ayrolles, C., Croquette, A. and Delmas, C. (2003). Computing the distribution of the maximum of Gaussian random processes. Methodology and Computing in Applied Probability, 5, 427-438.

A CONFIDENCE CORRIDOR FOR SPARSE LONGITUDINAL DATA CURVES

25

Csorgo, M. and Re´ve´sz, P. (1981) Strong Approximations in Probability and Statistics. Academic Press, New York-London.
Claeskens, G. and Van Keilegom, I. (2003). Bootstrap confidence bands for regression curves and their derivatives. Annals of Statistics 31, 1852-1884.
Fan, J. and Gijbels, I. (1996). Local Polynomial Modelling and Its Applications. Chapman and Hall, London.
Fan, J. and Yao, Q. (2005). Nonlinear Time Series. Springer-Verlag, New York. Fan, J. and Zhang, W. Y. (2000). Simultaneous confidence bands and hypothesis testing in varying-
coefficient models. Scandinavian Journal of Statistics 27, 715-731. Ferraty, F. and Vieu, P. (2006). Nonparametric Functional Data Analysis: Theory and Practice.
Springer Series in Statistics, Springer: Berlin. Hall, P., Mu¨ller, H. G. and Wang, J. L. (2006). Properties of principal component methods for
functional and longitudinal data analysis. Annals of Statistics 34, 1493-1517. James, G. M., Hastie, T. and Sugar, C. (2000). Principal Component Models for Sparse Functional
Data. Biometrika 87, 587­602. Li, Y. and Hsing, T. (2010). Uniform convergence rates for nonparametric regression and principal
component analysis in functional/longitudinal data. To appear in Annals of Statistics. Lucas, P. W. and Diggle, P. J. (1997). The use of longitudinal data analysis to study the multi-
seasonal growth responses of Norway and Sitka spruce to summer exposure to ozone: implications for the determination of critical levels. New Phytol. 137, 315­323. Ma, S., Yang, L. and Carroll, R. J. (2010). Simultaneous confidence band for sparse longitudinal regression. Statistica Sinica. forthcoming. Morris, J. S. and Carroll, R. J. (2006). Wavelet-based functional mixed models. Journal of the Royal Statistical Society, Series B 68, 179­199. Mu¨ller, H. G. (2009). Functional Modeling of Longitudinal data. Longitudinal Data Analysis, Handbooks of Modern Statistical Methods. Wiley, New York, 223­252. Mu¨ller, H. G., Stadtmu¨ller, U. (2005). Generalized functional linear models. Annals of Statistics

26 S. ZHENG, L. YANG AND W. K. HA¨ RDLE
33, 774-805. Piterbarg, V.I. (1996). Asymptotic Methods in the Theory of Gaussian Processes and Fields. Amer-
ican Mathematical Society. Song, Q. and Yang, L. (2009). Spline confidence bands for variance function. Journal of Nonpara-
metric Statistics 21, 589­609. Wang, J. and Yang, L. (2009). Polynomial spline confidence bands for regression curves. Statistica
Sinica 19, 325­342. Wang, N., Carroll, R. J. and Lin, X. (2005). Efficient semiparametric marginal estimation for
longitudinal/clustered data. Journal of the American Statistical Association 100, 147-157. Wu, W. and Zhao, Z. (2007). Inference of trends in time series. Journal of the Royal Statistical
Society, Series B 69, 391-410. Xia, Y. (1998). Bias-Corrected Confidence Bands in Nonparametric Regression. Journal of the Royal
Statistical Society. Series B 60, 797-811. Yao, F., Mu¨ller, H. G. and Wang, J. L. (2005a). Functional linear regression analysis for longi-
tudinal data. Annals of Statistics 33, 2873­2903. Yao, F., Mu¨ller, H. G. and Wang, J. L. (2005b). Functional data analysis for sparse longitudinal
data. Journal of the American Statistical Association 100, 577­590. Yao. F. (2007). Asymptotic distributions of nonparametric regression estimators for longitudinal or
functional data. Journal of Multivariate Analysis 98, 40­56. Zhang, J. T. and Chen, J. (2007). Statistical inferences for functional data. Annals of Statistics 35,
1052-1079. Zheng, S., Yang, L. and Ha¨rdle, W. (2010). Supplement to "A Confidence Corridor of Sparse
Longitudinal Date Curves". Manuscript. Zhao, Z. and Wu, W. (2008). Confidence bands in nonparametric time series regression. Annals of
Statistics 36, 1854-1878.

Shuzhuan Zheng Department of Statistics and Probability, Michigan State University, East Lansing, MI 48824 E-mail: zheng@stt.msu.edu

Lijian Yang Center for Advanced Statistics and Econometrics Research, Soochow University, Suzhou 215006, People's Republic of China and Department of Statistics and Probability, Michigan State University, East Lansing, MI 48824 E-mail: yang@stt.msu.edu

Wolfgang K. Ha¨rdle Center for Applied Statistics and Economics, Humboldt-Universita¨t zu Berlin, Unter den Linden 6, 10099 Berlin, Germany and Graduate Institute of Statistcis, National Central University, Jhongli 32049, Taiwan E-mail: stat@wiwi.hu-berlin.de

y -3 -2 -1 0 1 2 3

y -3 -2 -1 0 1 2 3

0.0 0.2 0.4 0.6 0.8 1.0
x
(a)

0.0 0.2 0.4 0.6 0.8 1.0
x
(b)

y -3 -2 -1 0 1 2 3

y -3 -2 -1 0 1 2 3

0.0 0.2 0.4 0.6 0.8 1.0
x
(c)

0.0 0.2 0.4 0.6 0.8
x
(d)

Fig 1. Plots of simulated data (circles) and trajectories (solid lines): (a) n = 20, (b) n = 50, (c) n = 100, (d) n = 200.

1.0

y -3 -2 -1 0 1 2 3

y -3 -2 -1 0 1 2 3

0.0 0.2 0.4 0.6 0.8 1.0
x
(a)

0.0 0.2 0.4 0.6 0.8 1.0
x
(b)

y -3 -2 -1 0 1 2 3

y -3 -2 -1 0 1 2 3

0.0 0.2 0.4 0.6 0.8 1.0
x
(c)

0.0 0.2 0.4 0.6 0.8
x
(d)

Fig 2. Plots of 99% SCC (upper and lower dotdashed lines), 95% SCC (upper and lower dotted lines), local linear estimator (median dashed line) and true mean function (median solid line): (a) n = 20, (b) n = 50, (c) n = 100, (d) n = 200.

1.0

Spinal Bone Density 0.4 0.6 0.8 1.0 1.2 1.4

Spinal Bone Density 0.4 0.6 0.8 1.0 1.2 1.4

10 15 20 25
Age (years)
(a)

10 15 20 25
Age (years)
(b)

Spinal Bone Density 0.4 0.6 0.8 1.0 1.2 1.4

Spinal Bone Density 0.4 0.6 0.8 1.0 1.2 1.4

10 15 20 25
Age (years)
(c)

10 15 20 25
Age (years)
(d)

Fig 3. Plots of the growth curve data, local linear estimator (median dashed line), SCC (upper and lower thick lines) and SCI (upper and lower solid lines): (a) the data, (b) confidence level = 90%, (c) confidence level = 95%, (d) confidence level = 99%

SFB 649 Discussion Paper Series 2011
For a complete list of Discussion Papers published by the SFB 649, please visit http://sfb649.wiwi.hu-berlin.de.
001 "Localising temperature risk" by Wolfgang Karl Härdle, Brenda López Cabrera, Ostap Okhrin and Weining Wang, January 2011.
002 "A Confidence Corridor for Sparse Longitudinal Data Curves" by Shuzhuan Zheng, Lijian Yang and Wolfgang Karl Härdle, January 2011.
SFB 649, Ziegelstraße 13a, D-10117 Berlin http://sfb649.wiwi.hu-berlin.de
This research was supported by the Deutsche Forschungsgemeinschaft through the SFB 649 "Economic Risk".

